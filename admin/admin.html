<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Administrador - Conversor de Moneda</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="estilo.css">
</head>
<body>
    <div class="container">
        <h1>Administrador - Conversor de Moneda</h1>
        
        <!-- Sección de Transferencias -->
        <h2>Transferencias</h2>
        <label for="minAmountTransfer">Monto Mínimo:</label>
        <input type="number" id="minAmountTransfer" step="0.01" required>
        <label for="maxAmountTransfer">Monto Máximo:</label>
        <input type="number" id="maxAmountTransfer" step="0.01" required>
        <label for="exchangeRateTransfer">Tasa de Cambio:</label>
        <input type="number" id="exchangeRateTransfer" step="0.01" required>
        <button id="saveButtonTransfer">Guardar Tasa de Transferencia</button>
        <div class="exchange-rates" id="exchangeRatesTransfer"></div>

        <!-- Sección de Depósitos -->
        <h2>Depósitos</h2>
        <label for="minAmountDeposit">Monto Mínimo:</label>
        <input type="number" id="minAmountDeposit" step="0.01" required>
        <label for="maxAmountDeposit">Monto Máximo:</label>
        <input type="number" id="maxAmountDeposit" step="0.01" required>
        <label for="exchangeRateDeposit">Tasa de Cambio:</label>
        <input type="number" id="exchangeRateDeposit" step="0.01" required>
        <button id="saveButtonDeposit">Guardar Tasa de Depósito</button>
        <div class="exchange-rates" id="exchangeRatesDeposit"></div>

        <!-- Botón para limpiar todos los registros -->
        <button id="clearAllButton">Limpiar Todos los Registros</button>

        <br><br>
        <a href="index.html">Ir a inicio</a>
    </div>

    <script>
        // URL base de tu API
        const apiBaseUrl = "https://tasas-50mllxys8-kevins-projects-14fc3e57.vercel.app/api";

        // Funciones para Transferencias
        function saveExchangeRateTransfer() {
            var minAmount = parseFloat(document.getElementById("minAmountTransfer").value);
            var maxAmount = parseFloat(document.getElementById("maxAmountTransfer").value);
            var exchangeRate = parseFloat(document.getElementById("exchangeRateTransfer").value);

            if (!minAmount || !maxAmount || !exchangeRate) {
                alert("Por favor, complete todos los campos en Transferencias.");
                return;
            }

            fetch(`${apiBaseUrl}/exchangeRatesTransfer`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ minAmount, maxAmount, exchangeRate })
            })
            .then(response => response.json())
            .then(data => {
                alert("¡Tasa de cambio guardada en Transferencias!");
                displayExchangeRatesTransfer();
            })
            .catch(error => console.error("Error:", error));
        }

        function displayExchangeRatesTransfer() {
            fetch(`${apiBaseUrl}/exchangeRatesTransfer`)
            .then(response => response.json())
            .then(data => {
                var exchangeRatesContainer = document.getElementById('exchangeRatesTransfer');
                exchangeRatesContainer.innerHTML = '';

                data.forEach(function(rate, index) {
                    var exchangeRateDiv = document.createElement('div');
                    exchangeRateDiv.classList.add('exchange-rate');
                    
                    exchangeRateDiv.innerHTML = `
                        <span>Min: ${rate.minAmount}, Max: ${rate.maxAmount}, Tasa: ${rate.exchangeRate}</span>
                        <button onclick="deleteExchangeRateTransfer(${rate.id})">Eliminar</button>
                    `;

                    exchangeRatesContainer.appendChild(exchangeRateDiv);
                });
            })
            .catch(error => console.error("Error:", error));
        }

        function deleteExchangeRateTransfer(id) {
            fetch(`${apiBaseUrl}/exchangeRatesTransfer/${id}`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                displayExchangeRatesTransfer();
            })
            .catch(error => console.error("Error:", error));
        }

        document.getElementById("saveButtonTransfer").addEventListener("click", saveExchangeRateTransfer);

        // Funciones para Depósitos
        function saveExchangeRateDeposit() {
            var minAmount = parseFloat(document.getElementById("minAmountDeposit").value);
            var maxAmount = parseFloat(document.getElementById("maxAmountDeposit").value);
            var exchangeRate = parseFloat(document.getElementById("exchangeRateDeposit").value);

            if (!minAmount || !maxAmount || !exchangeRate) {
                alert("Por favor, complete todos los campos en Depósitos.");
                return;
            }

            fetch(`${apiBaseUrl}/exchangeRatesDeposit`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ minAmount, maxAmount, exchangeRate })
            })
            .then(response => response.json())
            .then(data => {
                alert("¡Tasa de cambio guardada en Depósitos!");
                displayExchangeRatesDeposit();
            })
            .catch(error => console.error("Error:", error));
        }

        function displayExchangeRatesDeposit() {
            fetch(`${apiBaseUrl}/exchangeRatesDeposit`)
            .then(response => response.json())
            .then(data => {
                var exchangeRatesContainer = document.getElementById('exchangeRatesDeposit');
                exchangeRatesContainer.innerHTML = '';

                data.forEach(function(rate, index) {
                    var exchangeRateDiv = document.createElement('div');
                    exchangeRateDiv.classList.add('exchange-rate');
                    
                    exchangeRateDiv.innerHTML = `
                        <span>Min: ${rate.minAmount}, Max: ${rate.maxAmount}, Tasa: ${rate.exchangeRate}</span>
                        <button onclick="deleteExchangeRateDeposit(${rate.id})">Eliminar</button>
                    `;

                    exchangeRatesContainer.appendChild(exchangeRateDiv);
                });
            })
            .catch(error => console.error("Error:", error));
        }

        function deleteExchangeRateDeposit(id) {
            fetch(`${apiBaseUrl}/exchangeRatesDeposit/${id}`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                displayExchangeRatesDeposit();
            })
            .catch(error => console.error("Error:", error));
        }

        document.getElementById("saveButtonDeposit").addEventListener("click", saveExchangeRateDeposit);

        // Función para limpiar todos los registros
        function clearAllRecords() {
            fetch(`${apiBaseUrl}/exchangeRates`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                alert("¡Todos los registros han sido limpiados!");
                displayExchangeRatesTransfer();
                displayExchangeRatesDeposit();
            })
            .catch(error => console.error("Error:", error));
        }

        document.getElementById("clearAllButton").addEventListener("click", clearAllRecords);

        window.onload = function() {
            displayExchangeRatesTransfer();
            displayExchangeRatesDeposit();
        };
    </script>
</body>
</html>
